<!DOCTYPE html>
<html>
<head>
  <title>Poisson Disc Sampling Test</title>
  <meta charset="utf-8">
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      background-color: #f5f5f5;
    }
    h1 {
      color: #333;
    }
    .container {
      display: flex;
      gap: 40px;
      flex-wrap: wrap;
    }
    .canvas-container {
      background: white;
      padding: 10px;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    canvas {
      border: 1px solid #ccc;
      display: block;
      margin-top: 10px;
    }
    h2 {
      margin: 0 0 5px 0;
      font-size: 16px;
      color: #555;
    }
    .controls {
      margin-bottom: 20px;
      padding: 15px;
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    .controls label {
      margin-right: 20px;
    }
    .controls input {
      margin-right: 10px;
    }
    button {
      padding: 8px 16px;
      background: #4CAF50;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      margin-right: 10px;
    }
    button:hover {
      background: #45a049;
    }
  </style>
</head>
<body>
  <h1>Poisson Disc Sampling vs Pure Random Placement Test</h1>
  
  <div class="controls">
    <label>
      Number of Objects: 
      <input type="number" id="numObjects" value="25" min="5" max="100">
    </label>
    <label>
      Object Size: 
      <input type="number" id="objectSize" value="40" min="10" max="100">
    </label>
    <label>
      Poisson Disc Radius: 
      <input type="number" id="poissonDiscRadius" value="100" min="20" max="300">
    </label>
    <button onclick="regenerate()">Regenerate</button>
    <button onclick="regenerate10()">Regenerate x10</button>
  </div>
  
  <div class="container" id="container"></div>

  <script>
    // Parameters
    let params = {
      numObjects: 25,
      objectSize: 40,
      poissonDiscRadius: 100
    };

    // Pure random placement (old algorithm)
    function generateRandomPositions(width, height) {
      const positions = [];
      const padding = params.objectSize;
      const minX = padding;
      const maxX = width - padding;
      const minY = padding;
      const maxY = height - padding;

      for (let i = 0; i < params.numObjects; i++) {
        let x, y, overlapping;
        let attempts = 0;
        const maxAttempts = 1000;

        do {
          x = Math.random() * (maxX - minX) + minX;
          y = Math.random() * (maxY - minY) + minY;
          overlapping = false;

          for (let j = 0; j < positions.length; j++) {
            const dx = x - positions[j].x;
            const dy = y - positions[j].y;
            const distance = Math.sqrt(dx * dx + dy * dy);
            if (distance < params.objectSize) {
              overlapping = true;
              break;
            }
          }
          attempts++;
        } while (overlapping && attempts < maxAttempts);

        if (!overlapping) {
          positions.push({x, y});
        }
      }
      return positions;
    }

    // Poisson disc sampling (new algorithm)
    function generatePoissonDiscPositions(width, height) {
      const minRadius = params.poissonDiscRadius;
      const maxRadius = minRadius * 2;
      const numCandidates = 30;
      const padding = params.objectSize;
      const minX = padding;
      const maxX = width - padding;
      const minY = padding;
      const maxY = height - padding;

      function isValidPosition(x, y, allPositions, minDist) {
        if (x < minX || x > maxX || y < minY || y > maxY) {
          return false;
        }
        for (let i = 0; i < allPositions.length; i++) {
          const dx = x - allPositions[i].x;
          const dy = y - allPositions[i].y;
          const distance = Math.sqrt(dx * dx + dy * dy);
          if (distance < minDist) {
            return false;
          }
        }
        return true;
      }

      function generatePointInAnnulus(centerX, centerY, minR, maxR) {
        const angle = Math.random() * 2 * Math.PI;
        const r = Math.sqrt(Math.random() * (maxR * maxR - minR * minR) + minR * minR);
        return {
          x: centerX + r * Math.cos(angle),
          y: centerY + r * Math.sin(angle)
        };
      }

      let allPositions = [];
      let activeList = [];

      // Generate first point
      const startX = Math.random() * (maxX - minX) + minX;
      const startY = Math.random() * (maxY - minY) + minY;
      allPositions.push({x: startX, y: startY});
      activeList.push({x: startX, y: startY});

      // Poisson disc sampling
      while (allPositions.length < params.numObjects && activeList.length > 0) {
        const activeIndex = Math.floor(Math.random() * activeList.length);
        const activePoint = activeList[activeIndex];
        let pointAdded = false;

        for (let k = 0; k < numCandidates; k++) {
          const candidate = generatePointInAnnulus(activePoint.x, activePoint.y, minRadius, maxRadius);
          const collisionDist = Math.max(params.objectSize, minRadius);

          if (isValidPosition(candidate.x, candidate.y, allPositions, collisionDist)) {
            allPositions.push(candidate);
            activeList.push(candidate);
            pointAdded = true;
            break;
          }
        }

        if (!pointAdded) {
          activeList.splice(activeIndex, 1);
        }
      }

      // Fallback for remaining points
      if (allPositions.length < params.numObjects) {
        let fallbackCount = 0;
        const fallbackAttempts = 1000;

        while (allPositions.length < params.numObjects && fallbackCount < fallbackAttempts) {
          const x = Math.random() * (maxX - minX) + minX;
          const y = Math.random() * (maxY - minY) + minY;

          if (isValidPosition(x, y, allPositions, params.objectSize)) {
            allPositions.push({x, y});
          }
          fallbackCount++;
        }
      }

      return allPositions;
    }

    // Draw positions on canvas
    function drawPositions(canvas, positions, title) {
      const ctx = canvas.getContext('2d');
      ctx.fillStyle = '#f8f8f8';
      ctx.fillRect(0, 0, canvas.width, canvas.height);

      // Draw grid
      ctx.strokeStyle = '#eee';
      ctx.lineWidth = 1;
      for (let x = 0; x < canvas.width; x += 50) {
        ctx.beginPath();
        ctx.moveTo(x, 0);
        ctx.lineTo(x, canvas.height);
        ctx.stroke();
      }
      for (let y = 0; y < canvas.height; y += 50) {
        ctx.beginPath();
        ctx.moveTo(0, y);
        ctx.lineTo(canvas.width, y);
        ctx.stroke();
      }

      // Draw objects
      const colors = ['#e74c3c', '#3498db', '#2ecc71', '#f1c40f', '#9b59b6'];
      positions.forEach((pos, i) => {
        ctx.beginPath();
        ctx.arc(pos.x, pos.y, params.objectSize / 2, 0, 2 * Math.PI);
        ctx.fillStyle = colors[i % colors.length];
        ctx.fill();
        ctx.strokeStyle = '#333';
        ctx.lineWidth = 1;
        ctx.stroke();
      });

      // Draw title
      ctx.fillStyle = '#333';
      ctx.font = 'bold 14px Arial';
      ctx.fillText(`${title} (${positions.length} objects)`, 10, 20);
    }

    function createCanvasSet() {
      const width = 500;
      const height = 400;

      const container = document.getElementById('container');

      // Random placement canvas
      const randomContainer = document.createElement('div');
      randomContainer.className = 'canvas-container';
      const randomTitle = document.createElement('h2');
      randomTitle.textContent = 'Pure Random (Old Algorithm)';
      randomContainer.appendChild(randomTitle);
      const randomCanvas = document.createElement('canvas');
      randomCanvas.width = width;
      randomCanvas.height = height;
      randomContainer.appendChild(randomCanvas);
      container.appendChild(randomContainer);

      // Poisson disc canvas
      const poissonContainer = document.createElement('div');
      poissonContainer.className = 'canvas-container';
      const poissonTitle = document.createElement('h2');
      poissonTitle.textContent = 'Poisson Disc Sampling (New Algorithm)';
      poissonContainer.appendChild(poissonTitle);
      const poissonCanvas = document.createElement('canvas');
      poissonCanvas.width = width;
      poissonCanvas.height = height;
      poissonContainer.appendChild(poissonCanvas);
      container.appendChild(poissonContainer);

      // Generate and draw
      const randomPositions = generateRandomPositions(width, height);
      const poissonPositions = generatePoissonDiscPositions(width, height);

      drawPositions(randomCanvas, randomPositions, 'Random');
      drawPositions(poissonCanvas, poissonPositions, 'Poisson Disc');
    }

    function regenerate() {
      params.numObjects = parseInt(document.getElementById('numObjects').value) || 25;
      params.objectSize = parseInt(document.getElementById('objectSize').value) || 40;
      params.poissonDiscRadius = parseInt(document.getElementById('poissonDiscRadius').value) || 100;

      document.getElementById('container').innerHTML = '';
      createCanvasSet();
    }

    function regenerate10() {
      params.numObjects = parseInt(document.getElementById('numObjects').value) || 25;
      params.objectSize = parseInt(document.getElementById('objectSize').value) || 40;
      params.poissonDiscRadius = parseInt(document.getElementById('poissonDiscRadius').value) || 100;

      document.getElementById('container').innerHTML = '';
      for (let i = 0; i < 10; i++) {
        createCanvasSet();
      }
    }

    // Initial generation
    createCanvasSet();
  </script>
</body>
</html>
